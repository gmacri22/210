<html>
<head>
<title>Backpack</title>
<style type="text/css">
	h1 {
	    font-size: 50px;
	    font-family: arial;
            text-align: center;
            color: #4d4d4d;
	}
        a {
            color: lightblue;
        }
        body {
            background-color: #4d4d4d;
        }
        #container {
            background-color: lightblue;
            height: 665px;
        }
        #form {
            padding: 15px;
            border: 10px solid darkcyan;
            margin: 15px;
            background-color: azure;
            width: 470px;
            height: 90px;
            float: left;
        }
        #buttons {
            padding: 15px;
            border: 10px solid darkcyan;
            margin: 15px;
            background-color: azure;
            width: 150px;
            height: 90px;
            float: left;
            margin-left: 20px;
        }
        table, th, td {
            padding: 5px;
        }
        th {
            background-color: darkcyan;
            color: white;
        }
        td {
            background-color: #4d4d4d;
            color: white;
        }
        .btn {
            -webkit-border-radius: 3;
            -moz-border-radius: 3;
            border-radius: 3px;
            background: #4d4d4d;
            font-family: Arial;
            color: #ffffff;
            border: solid #ffffff 1px;
            font-size: 12px;
            padding: 4px 8px 4px 8px;
            text-decoration: none;
        }
        .btn:hover {
            background: #a6a6a6;
            text-decoration: none;
       }
        

</style>

<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript">

if(localStorage['login'] == undefined){
    window.location.replace("http://localhost:3000/login.html");
}

$(document).ready(function() {
  $("#welcomeDiv").html("Hello, "+ localStorage['login']);
  $("#secretUsername").attr("value", localStorage['login']);

  $.get('/backpack.html/'+localStorage['login'], localStorage['login'], function(data, textStatus, jqXHR) {
          console.log('am i in this get thing?');
          $("#tableDiv").html(data);
  }, 'html');


$(document).on('click', "button.del", function() {
    console.log("del function");
    $.ajax({
        url: "/backpack.html",
        type: "DELETE",
        data: {username:localStorage['login'], id:parseInt(this.value)}, 
        dataType: "html",
        success: function (data ) {
            console.log("Delete button clicked");
            $("#tableDiv").html(data);
        }
    });
});


  $(document).ajaxError(function() {
    //alert("Sorry, there was a problem!");
  });

  $("#readButton").click(function() {
    // From: http://learn.jquery.com/ajax/jquery-ajax-methods/
    // Using the core $.ajax() method
    $.ajax({
      // The URL for the request -- note the simple REST API!
      // all URLs are relative to http://localhost:3000/
      url: "users/" + $("#nameBox").val(),
      type: "GET",
      dataType : "json", // this URL returns data in JSON format
      success: function( data ) {
        console.log("You received some data!", data);
        if (data.username) {
          $("#nameDiv").html("My name is " + data.username);
          $("#passDiv").html("My password is " + data.password);
        } else {
          $("#status").html("Error: could not find user!");

          $("#nameDiv").html("");
          $("#passDiv").html("");
        }
      },
    });
  });
  $("#updateButton").click(function() {
        window.location.replace("http://localhost:3000/accountinfo.html");
  });

$("#logoutButton").click(function() {
    $.ajax({
      url: "users/" + $("#nameBox").val(),
      type: "GET",
      dataType : "json", // this URL returns data in JSON format
      success: function( data ) {
          //localStorage['login'] = undefined;
          localStorage.clear();
          window.location.replace("http://localhost:3000/login.html");
      },
    });
  });

$('#form').submit(function(e) {
    e.preventDefault();
    $.post('backpack.html', $('form').serialize(), function(data, textStatus, jqXHR) {
          console.log('am i in this get thing?');
          $("#tableDiv").html(data);
          $("#aform")[0].reset();
  }, 'html');
});
//////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////


var theContent = $('test');

$(document).on('click', "button.edit", function() { 
//$('#testButton').on('click', function(){
    console.log("clicked test button");


    var editElem = document.getElementById("test");
    console.log(editElem);

//get the edited element content
    var userVersion = editElem.innerHTML;
    console.log(userVersion);


    $.ajax({
          url: '/backpack.html/' + userVersion + "&" + localStorage['login'] + "&" + parseInt(this.value),
          type: "PUT",
          dataType : "text", // this URL returns a plain text string, not JSON
          data: {username:, id:},
          success: function( data ) {
              console.log("You received some data!", data);
              if (data == 'OK') {
                  console.log("userVersion " + userVersion);
                  
          
              } else {
                  console.log("uhhh something bad happened");
              }
          },
    });
  

});


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////



  $("#deleteButton").click(function() {
    $.ajax({
      url: "users/" + localStorage['login'],
      type: "DELETE",
      dataType : "text", // this URL returns a plain text string, not JSON
      success: function( data ) {
        localStorage.clear();
        window.location.replace("http://localhost:3000/login.html");
      },
    });
  });
});



</script>

</head>
  <body>
<div id="container">

  <p id="test" contenteditable="true"> TESTING EDITABLE CONTENT </p>
  <button id="testButton" button type = "button" class="btn edit"> TEST </button>

  <h1>Welcome to Backpack!</h1>

    <div id="buttons">
    <button id="readButton" button type="button" class="btn">Find another user</button>
    <button id="updateButton" button type="button" class="btn">Update my profile</button>
    <button id="deleteButton" button type="button" class="btn">Delete my profile</button>
    <button id ="logoutButton" button type="button" class="btn">Logout</button>
    </div>

    <div id="form">
    Add a new resource: 
    <form id= "aform" method="post">
      Title: <input id="title" type="text" name="title" size="20" style="width: 100px;"/>
      Link: <input id="link" type="text" name="link" size="20" style="width: 250px;"/> <br>
      Description: <input id="body" type="text" name="body" size="20" style="width: 350px;"/> <br>
      <input id = "secretUsername" type = "hidden" name="secretUsername" value="">
      <input id= "addButton" type="submit" name="addButton" value="Add" button type="button" class="btn">
    </form>
    </div>

    <div id="tableDiv">You haven't added any resources yet!</div>
    </div>

    <div id="status"></div>
  </body>
</html>
